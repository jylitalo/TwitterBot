---
# tasks file for TwitterBot
- name: install pip
  package:
    name: python-pip
    state: present
- name: install twitter API for python
  pip:
    name: python-twitter
    state: present
- name: user for cronjob
  user:
    name: "{{ twitbot_user }}"
    comment: TwitterBot
    home: "{{ twitbot_home }}"
    system: yes
- name: ensure directory is private
  file:
    path: "{{ twitbot_home }}"
    state: directory
    owner: "{{ twitbot_user }}"
    mode: 0700
- name: copy python script
  copy:
    src: "{{ role_path }}/files/twitter-bot.py"
    dest: "{{ twitbot_bin }}"
    owner: "{{ twitbot_user }}"
    mode: 0700
- name: copy configuration file
  copy:
    src: "{{ twitbot_cf }}"
    dest: "{{ twitbot_conf }}"
    owner: "{{ twitbot_user }}"
    mode: 0600
  when: twitbot_cf != ""
- name: install configuration from template
  template:
    src: "{{ role_path }}/templates/twitter-bot.cf.j2"
    dest: "{{ twitbot_conf }}"
    owner: "{{ twitbot_user }}"
    mode: 0600
    backup: yes
  when: twitbot_cf == ""
- name: validate installation
  shell: "{{ twitbot_bin }} --config {{ twitbot_conf }} --validate"
- name: schedule reporting
  cron:
    name: TwitterBot
    job: "{{ twitbot_bin }} --config {{ twitbot_conf }}"
    special_time: daily
    user: "{{ twitbot_user }}"
